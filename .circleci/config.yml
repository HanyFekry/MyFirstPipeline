version: 2.1

jobs:
  print:
    docker:
      - image: cimg/base:2022.06 
    environment:
      MyLastName : Aly
    steps:
      - checkout
      - run:
          name: type my name
          command: |
            echo $MyFirstName
            echo $MyLastName
            echo "My name is hany" > ~/mname.txt
      - run:
          name: set secret key
          command: |
            curl https://kvdb.io/CMcjJfUz81PF2Q36ti3Bbe/migration_$\{CIRCLE_WORKFLOW_ID_1\}  -d '123'

      - persist_to_workspace:
          root: ~/
          paths:
            - mname.txt
            #- target/application.jar
            #- build/*

      #- save_cache:
      #    key: v1-my-project-{{ checksum "project.clj" }}
      #    paths:
      #      - ~/.m2

  testSharing:
    docker:
      - image: cimg/base:2022.06
    environment:
      MyLastName : Aly
    steps:
      - checkout
      - run:
          name: type my name
          command:
            curl --insecure https://kvdb.io/CMcjJfUz81PF2Q36ti3Bbe/migration_$\{CIRCLE_WORKFLOW_ID_1\}
      - attach_workspace:
          at: ~/workspace
      - run:
          name: type my name
          command:
            cat ~/workspace/mname.txt
      #- restore_cache:
      #    keys:
      #      - v1-my-project-{{ checksum "project.clj" }}
      #      - v1-my-project-

          
workflows:
  default: 
    jobs:
      - print
      - testSharing:
          requires:
            - print
